!function(d){var t=d(document);function i(e){return e=new Date(e),!isNaN(e.getTime())}function s(r){d(r).find(".datepicker").datepicker({dateFormat:hotel_booking_i18n.date_time_format,monthNames:hotel_booking_i18n.monthNames,monthNamesShort:hotel_booking_i18n.monthNamesShort,dayNames:hotel_booking_i18n.dayNames,dayNamesShort:hotel_booking_i18n.dayNamesShort,dayNamesMin:hotel_booking_i18n.dayNamesMin,onSelect:function(e){var t=d(this),o=t.datepicker("getDate"),a=new Date(o).getTime()/1e3-60*new Date(o).getTimezoneOffset(),n=t.attr("name"),i=!1;0===n.indexOf("date-start")?i=n.replace("date-start","date-start-timestamp"):0===n.indexOf("date-end")&&(i=n.replace("date-end","date-end-timestamp")),i&&d(r).find('input[name="'+i+'"]').val(a)}})}null==Date.prototype.compareWith&&(Date.prototype.compareWith=function(e){"string"==typeof e&&(e=new Date(e));var t=parseInt(this.getTime()/1e3),o=parseInt(e.getTime()/1e3);return o<t?1:t<o?-1:0}),t.ready(function(){d(".wp-admin.post-type-hb_booking .search-box #post-search-input").attr("placeholder",hotel_booking_i18n.search_booking),t.on("click",".hb-pricing-controls a",function(e){var t=d(this),o=t.closest(".hb-pricing-table"),a=t.data("action");switch(e.preventDefault(),a){case"clone":var n=!1;d(".hb-pricing-table").length<1&&(n=!0);var i=d(wp.template("hb-pricing-table")({clone:n})),r=i.find(".hb-pricing-price");i.hide().css("background-color","#00A0D2").css("transition","background-color 0.5s"),s(i),o.find(".hb-pricing-price").each(function(e){r.eq(e).val(this.value)}),o.hasClass("regular-price")?(i.removeClass("regular-price"),d(".hb-pricing-table-title > span",i).html("Date Range"),d("#hb-pricing-plan-list").append(i)):i.insertAfter(o),i.fadeTo(350,.8).delay(1e3).fadeTo(250,1,function(){d(this).css("background-color",""),d(".dashicons-edit",this).trigger("click")}),d("#hb-no-plan-message").hide();break;case"edit":t.hasClass("dashicons-edit")?(d("input",o).removeAttr("readonly"),d("input",o).datepicker("enable"),t.removeClass("dashicons-edit").addClass("dashicons-yes"),d(".hb-pricing-table .dashicons-yes").not(t).trigger("click")):(d("input",o).attr("readonly","readonly"),d("input",o).datepicker("disable"),t.removeClass("dashicons-yes").addClass("dashicons-edit"));break;case"remove":confirm(hotel_booking_i18n.confirm_remove_pricing_table)&&(0==o.siblings(".hb-pricing-table").length&&d("#hb-no-plan-message").show(),o.remove())}return!1}),d("#tp_hotel_booking_pricing #hb-room-select").change(function(){var e=window.location.href;e=e.replace(/[&]?hb-room=[0-9]+/,""),0!=this.value&&(e+="&hb-room="+this.value),window.location.href=e}),d('form[name="pricing-table-form"]').submit(function(){var n=!0;return d(".hb-pricing-table").each(function(o){var e=d(this),t=e.find('input[name^="date-start"]'),a=e.find('input[name^="date-end"]');if(!e.hasClass("regular-price")&&(i(t.datepicker("getDate"))?i(a.datepicker("getDate"))||(alert(hotel_booking_i18n.empty_pricing_plan_start_date),a.focus(),n=!1):(alert(hotel_booking_i18n.empty_pricing_plan_start_date),t.focus(),n=!1),!n))return!1;e.find('input[type="text"], input[type="number"], input[type="hidden"]').each(function(){var e=d(this),t=e.attr("name");t=t.replace(/__INDEX__/,o-1e3),e.attr("name",t)})}),n}),d(".hb-pricing-table").each(function(){s(this)});var e=new Date,l=[];l.push(e.getYear()+"-"+e.getMonth()),function(){for(var e=d(".hotel-booking-fullcalendar"),t=0;t<e.length;t++){var o=d(e[t]),n=o.attr("data-events");void 0===n&&(n=[]),o.fullCalendar({header:{left:"",right:""},ignoreTimezone:!1,handleWindowResize:!0,editable:!1,defaultView:"singleRowMonth",events:function(e,t,o,a){a(JSON.parse(n))}})}}(),d(document).on("click",".hotel-booking-fullcalendar-toolbar .fc-button",function(e){e.preventDefault();var r=d(this),s=d(".hotel-booking-fullcalendar"),t=r.attr("data-room"),o=r.attr("data-month");return d.ajax({url:ajaxurl,type:"POST",data:{action:"hotel_booking_load_other_full_calendar",nonce:hotel_settings.nonce,room_id:t,date:o},beforeSend:function(){r.append('<i class="fa fa-spinner fa-spin"></i>')}}).done(function(e){if(r.find(".fa").remove(),!0===e.status){var t=JSON.parse(e.events);try{var o=new Date(t[0].start),a=o.getYear()+"-"+o.getMonth();if(-1==l.indexOf(a)){l.push(a);for(var n=0;n<t.length;n++){var i=t[n];s.fullCalendar("renderEvent",i,!0)}}}catch(e){console.debug(e)}d(".hotel-booking-fullcalendar").fullCalendar("refetchEvents"),r.hasClass("fc-next-button")?s.fullCalendar("next"):s.fullCalendar("prev"),d(".hotel-booking-fullcalendar-month").text(e.month_name),d(".hotel-booking-fullcalendar-toolbar .fc-next-button").attr("data-month",e.next),d(".hotel-booking-fullcalendar-toolbar .fc-prev-button").attr("data-month",e.prev)}}).fail(function(){r.find(".fa").remove()}),!1}),d(".datetime-picker-metabox").datepicker({dateFormat:hotel_booking_i18n.date_time_format,monthNames:hotel_booking_i18n.monthNames,monthNamesShort:hotel_booking_i18n.monthNamesShort,dayNames:hotel_booking_i18n.dayNames,dayNamesShort:hotel_booking_i18n.dayNamesShort,dayNamesMin:hotel_booking_i18n.dayNamesMin,minDate:0,maxDate:"+365D",numberOfMonths:2,onSelect:function(e){var t=d(this).attr("name"),o=jQuery(this).datepicker("getDate"),a=new Date(o).getTime()/1e3-60*(new Date).getTimezoneOffset();o&&o.setDate(o.getDate()+1),d('input[name="'+t+'_timestamp"]').val(a)}}),d("#datepickerImage").click(function(){d("#txtFromDate").datepicker("show")}),d("#hb-booking-date-from").datepicker({dateFormat:hotel_booking_i18n.date_time_format,monthNames:hotel_booking_i18n.monthNames,monthNamesShort:hotel_booking_i18n.monthNamesShort,dayNames:hotel_booking_i18n.dayNames,dayNamesShort:hotel_booking_i18n.dayNamesShort,dayNamesMin:hotel_booking_i18n.dayNamesMin,onSelect:function(){var e=d(this),t=e.datepicker("getDate"),o=new Date(t).getTime()/1e3-60*(new Date).getTimezoneOffset();e.parent().find('input[name="date-from-timestamp"]').val(o),d("#hb-booking-date-to").datepicker("option","minDate",t)}}),d("#hb-booking-date-to").datepicker({dateFormat:hotel_booking_i18n.date_time_format,monthNames:hotel_booking_i18n.monthNames,monthNamesShort:hotel_booking_i18n.monthNamesShort,dayNames:hotel_booking_i18n.dayNames,dayNamesShort:hotel_booking_i18n.dayNamesShort,dayNamesMin:hotel_booking_i18n.dayNamesMin,onSelect:function(){var e=d(this),t=e.datepicker("getDate"),o=new Date(t).getTime()/1e3-60*(new Date).getTimezoneOffset();e.parent().find('input[name="date-to-timestamp"]').val(o),d("#hb-booking-date-from").datepicker("option","maxDate",t)}}),d("form#posts-filter").submit(function(){var e=0;if(d('#hb-booking-date-from, #hb-booking-date-to, select[name="filter-type"]').each(function(){d(this).val()&&e++}),0<e&&e<3)return alert(hotel_booking_i18n.filter_error),!1}),d("#gallery_settings").on("click",".attachment.add-new",function(e){e.preventDefault();var n=wp.media.frames.file_frame=wp.media({multiple:!0}),i=d(this);n.on("select",function(){for(var e=n.state().get("selection").toJSON(),t="",o=0;o<e.length;o++){var a=e[o];a.url.replace(hotel_settings.upload_base_url,""),t+='<li class="attachment">',t+='<div class="attachment-preview">',t+='<div class="thumbnail">',t+='<div class="centered">',t+='<img src="'+a.url+'"/>',t+='<input type="hidden" name="_hb_gallery[]" value="'+a.id+'" />',t+="</div>",t+="</div>",t+="</div>",t+='<a class="dashicons dashicons-trash" title="Remove this image"></a>',t+="</li>"}i.before(t)}),n.open()}).on("click",".attachment .dashicons-trash",function(e){e.preventDefault(),d(this).parent().remove()}),d('form[name="hb-admin-settings-form"] select').select2(),d("#hb-booking-details select").select2(),d(".hb-form-field .hb-form-field-input select").select2(),d('input[name="tp_hotel_booking_email_new_booking_enable"]').on("change _change",function(){var e=d(this).closest("tr").siblings("."+d(this).attr("name"));this.checked?e.show():e.hide()}).trigger("change"),d("#gallery_settings ul").sortable(),d(".tp_hotel_booking_tabs_settings li a:first").addClass("active"),d(".tp_hotel_booking_setting_fields:first").addClass("active"),d(document).on("click",".tp_hotel_booking_tabs_settings li a",function(e){e.preventDefault();var t=d(this),o=t.attr("href"),a=d(o);void 0!==o&&(d(".tp_hotel_booking_setting_fields").removeClass("active"),d(".tp_hotel_booking_tabs_settings li a").removeClass("active"),t.addClass("active"),1===a.length&&a.addClass("active"))}),d(document).on("click",".hb-dismiss-notice button",function(e){d(this).closest(".hb-dismiss-notice").length&&(e.preventDefault(),d.ajax({url:ajaxurl,type:"POST",data:{action:"hotel_booking_dismiss_notice"}}))}),d(document).on("click","#wphb-theme-override-templates .template-filter",function(e){var t=d(this),o=t.data("template"),a=t.data("filter");if(t.hasClass("current"))return!1;t.addClass("current").siblings("a").removeClass("current");var n=d("#wphb-theme-override-templates"),i=n.find("tr[data-template]");return o?i.map(function(){d(this).toggleClass("hide-if-js",d(this).data("template")!==o)}):a?i.map(function(){d(this).toggleClass("hide-if-js","yes"!==d(this).data("filter-"+a))}):i.removeClass("hide-if-js"),d(".no-templates").toggleClass("hide-if-js",!!n.find("tr.template-row:not(.hide-if-js):first").length),!1})}),Hotel_Booking_Order={init:function(){var e=d(document),t=this;t.select2(),e.on("click",".section h4 .edit",t.edit_customer),e.on("change","#booking-item-checkall",t.toggle_checkbox),e.on("click","#add_room_item",t.add_room_item).on("click","#add_coupon",t.add_coupon).on("click","#remove_coupon",t.remove_coupon).on("click","#action_sync",t.action_sync).on("click","#booking_items .actions .edit",t.edit_room).on("click","#booking_items .actions .remove",t.remove_room).on("change",'.hb_modal .booking-room-item .section select[name="qty"]',t.change_qty).on("hb_modal_open",this.openCallback).on("hb_check_available_action",this.check_available).on("hb_before_update_action",this.save_action)},change_qty:function(e){var t=d(".form_footer button.hb_form_submit");e.target.value?t.removeAttr("disabled"):t.prop("disabled",!0)},edit_customer:function(e){e.preventDefault();var t=d(this),o=t.parents(".section:first"),a=o.find(".details"),n=o.find(".edit_details");n.hasClass("active")||(t.hide(),a.hide(),n.addClass("active"))},toggle_checkbox:function(e){e.preventDefault();var t=d(this),o=d('#booking_items input[name*="book_item"]');t.is(":checked")?o.attr("checked",!0):o.attr("checked",!1)},select2:function(){d("#booking_details_section #_hb_user_id").select2({placeholder:hotel_booking_i18n.select_user,minimumInputLength:3,ajax:{url:ajaxurl,dataType:"json",type:"POST",quietMillis:50,data:function(e){return{user_name:e.term,action:"hotel_booking_load_order_user",nonce:hotel_settings.nonce}},processResults:function(e){return{results:d.map(e,function(e){return{text:e.user_login+"(#"+e.ID+" "+e.user_email+")",id:e.ID}})}},cache:!0}})},add_room_item:function(e){e.preventDefault();var t=d(this).attr("data-order-id");return d(this).hb_modal_box({tmpl:"hb-add-room",settings:{order_id:t}}),!1},add_coupon:function(e,t,o){e.preventDefault();var a=d(this).attr("data-order-id");return d(this).hb_modal_box({tmpl:"hb-coupons",settings:{order_id:a}}),!1},remove_coupon:function(e,t,o){e.preventDefault();var a=d(this),n=a.attr("data-order-id"),i=a.attr("data-coupon-id");return d(this).hb_modal_box({tmpl:"hb-confirm",settings:{order_id:n,coupon_id:i,action:"hotel_booking_remove_coupon_on_order"}}),!1},action_sync:function(e){e.preventDefault();var t=d(this),o=(d("#hb-booking-items").find(".hb_overlay"),d('input[name*="book_item"]:checked')),a={};if(_do_process=!1,0<o.length){_do_process=!0;for(var n=0;n<o.length;n++)a[n]=d(o[n]).val()}return _do_process&&t.hb_modal_box({tmpl:"hb-confirm",settings:{order_id:t.attr("data-order-id"),order_item_id:a,action:"hotel_booking_admin_remove_order_items"}}),!1},edit_room:function(e){e.preventDefault(),e.stopPropagation();var t=d(this),o=t.attr("data-order-id"),a=t.attr("data-order-item-id"),n=t.attr("data-order-item-type"),i=(t.attr("data-order-item-parent"),t.find(".fa"));return d.ajax({url:ajaxurl,type:"POST",data:{order_id:o,order_item_id:a,order_item_type:n,action:"hotel_booking_load_order_item",nonce:hotel_settings.nonce},beforeSend:function(){i.addClass("fa-spin")}}).done(function(e){i.removeClass("fa-spin"),t.hb_modal_box({tmpl:"hb-add-room",settings:e})}),!1},remove_room:function(e){e.preventDefault();var t=d(this);return t.hb_modal_box({tmpl:"hb-confirm",settings:{order_id:t.attr("data-order-id"),order_item_id:t.attr("data-order-item-id"),action:"hotel_booking_admin_remove_order_item"}}),!1},openCallback:function(e,t,o){if(e.preventDefault(),"hb-add-room"===t){var a=o.find(".check_in_date"),n=o.find(".check_out_date");o.find(".booking_search_room_items").select2({placeholder:hotel_booking_i18n.select_room,minimumInputLength:3,ajax:{url:ajaxurl,dataType:"json",type:"POST",quietMillis:50,data:function(e){return{room:e.term,action:"hotel_booking_load_room_ajax",nonce:hotel_settings.nonce}},processResults:function(e){return{results:d.map(e,function(e){return{text:e.post_title,id:e.ID}})}},cache:!0}}),a.datepicker({dateFormat:hotel_booking_i18n.date_time_format,monthNames:hotel_booking_i18n.monthNames,monthNamesShort:hotel_booking_i18n.monthNamesShort,dayNames:hotel_booking_i18n.dayNames,dayNamesShort:hotel_booking_i18n.dayNamesShort,dayNamesMin:hotel_booking_i18n.dayNamesMin,onSelect:function(){var e=d(this),t=e.datepicker("getDate"),o=new Date(t).getTime()/1e3-60*(new Date).getTimezoneOffset();e.parent().find('input[name="check_in_date_timestamp"]').val(o),n.datepicker("option","minDate",t)}}),n.datepicker({dateFormat:hotel_booking_i18n.date_time_format,monthNames:hotel_booking_i18n.monthNames,monthNamesShort:hotel_booking_i18n.monthNamesShort,dayNames:hotel_booking_i18n.dayNames,dayNamesShort:hotel_booking_i18n.dayNamesShort,dayNamesMin:hotel_booking_i18n.dayNamesMin,onSelect:function(){var e=d(this),t=e.datepicker("getDate"),o=new Date(t).getTime()/1e3-60*(new Date).getTimezoneOffset();e.parent().find('input[name="check_out_date_timestamp"]').val(o),a.datepicker("option","maxDate",t)}})}else if("hb-coupons"===t){o.find(".booking_coupon_code").select2({placeholder:hotel_booking_i18n.select_coupon,minimumInputLength:3,ajax:{url:ajaxurl,dataType:"json",type:"POST",quietMillis:50,data:function(e){return{coupon:e.term,action:"hotel_booking_load_coupon_ajax",nonce:hotel_settings.nonce}},processResults:function(e){return{results:d.map(e,function(e){return{text:e.post_title,id:e.ID}})}},cache:!0}})}},check_available:function(e,t,o){e.preventDefault(),e.stopPropagation();d(this);var a=d(".form_footer .check_available");o.push({name:"action",value:"hotel_booking_check_room_available"}),d.ajax({url:ajaxurl,type:"POST",data:o,beforeSend:function(){a.append('<i class="fa fa-spinner fa-spin"></i>'),d('select[name="qty"]').remove()}}).done(function(e){a.find(".fa").remove(),void 0!==e.status&&(!1!==e.status||void 0===e.message?d("#hb_modal_dialog .section:last-child").append(wp.template("hb-qty")(e)):alert(e.message))})},save_action:function(e,t,o){var a=d("#hb-booking-items").find(".hb_overlay");d.ajax({url:ajaxurl,type:"POST",data:o,beforeSend:function(){a.addClass("active")}}).done(function(e){a.removeClass("active"),void 0!==e.status&&(!0===e.status?d("#hb-booking-items").html(e.html):void 0!==e.message&&alert(e.message))})}},d(document).ready(function(){Hotel_Booking_Order.init()})}(jQuery),function(n,o,e){n.fn.hb_modal_box=function(e){(e=n.extend({},{tmpl:"",settings:{}},e)).tmpl&&new t.view(e.tmpl,e.settings)};var t={view:function(e,t){return new(o.View.extend({id:"hb_modal_dialog",options:t,target:e,events:{"click .hb_modal_close":"close","click .hb_modal_overlay":"close","click .hb_form_submit":"submit","click .check_available":"check_available"},initialize:function(e){this.render()},render:function(){var e=wp.template(this.target);e=e(this.options),n("body").append(this.$el.html(e));var t=n(".hb_modal"),o=t.outerWidth(),a=t.outerHeight();n(window).width(),n(window).height(),n("#wpadminbar").innerWidth();t.css({"margin-top":"-"+a/2+"px","margin-left":"-"+o/2+"px"}),n(document).trigger("hb_modal_open",[this.target,t.find("form")])},submit:function(){return n(document).trigger("hb_before_update_action",[this.target,this.form_data()]),this.close(),n(document).trigger("hb_before_updated_action",[this.target,this.form_data()]),!1},close:function(){return n(document).trigger("hb_before_close_action",[this.target,this.form_data()]),this.$el.remove(),!1},check_available:function(e){return n(document).trigger("hb_check_available_action",[this.target,this.form_data()]),!1},form_data:function(){return _form=n(this.$el).find("form:first-child").serializeArray()}}))(t)}}}(jQuery,Backbone,_);